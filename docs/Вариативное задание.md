# Командная строка (CLI) на Javascript #
Проект демонстрирует создание собственной командной строки для выполнения различных команд.

## 1. Исследование предметной области
### Что такое командная строка?
Командная строка (CLI) — это инструмент, предоставляющий текстовый интерфейс для взаимодействия с программой или операционной системой. Взаимодействие осуществляется путем ввода текстовых команд и получения текстового вывода. Вместо графических элементов управления, взаимодействие полностью основано на текстовых командах.

В отличие от полноценных системных оболочек, таких как Bash, Zsh или PowerShell, разрабатываемые CLI часто фокусируются на конкретной области применения, такой как разработка, автоматизация задач, или управление специализированными приложениями. Основное преимущество такого подхода – возможность создания инструментов, точно соответствующих потребностям конкретного пользователя или проекта.

CLI предоставляет пользователю систему управления приложением, способную взаимодействовать с файловой системой, сетью, другими процессами и пользовательским вводом. Это упрощает выполнение определенных действий и ускоряет работу, поскольку операции выполняются посредством команд.

### Основные компоненты CLI
* Аргументы командной строки: Массив строк, передаваемых программе при запуске, содержащий информацию о команде и ее параметрах. Первые элементы массива обычно содержат сведения о среде выполнения, последующие – непосредственно аргументы команды.
* Стандартные потоки ввода/вывода: Механизм для обмена данными между программой и пользователем (или другими программами). Включает в себя стандартный ввод (stdin) для получения данных от пользователя, стандартный вывод (stdout) для отображения результатов и стандартный поток ошибок (stderr) для вывода сообщений об ошибках.
* Парсер аргументов: Компонент, отвечающий за разбор и интерпретацию аргументов командной строки, преобразуя их в структурированные данные, пригодные для дальнейшей обработки программой. Существуют как готовые библиотеки, так и возможность ручной реализации парсера.
* Работа с файловой системой: Большинство CLI взаимодействуют с файловой системой, предоставляя команды для создания, удаления, переименования, копирования и перемещения файлов и каталогов. Для этого используются соответствующие API операционной системы или, при кроссплатформенной разработке, специализированные библиотеки.
* Выполнение внешних процессов: Возможность запускать другие программы и команды операционной системы из CLI. Это позволяет расширить функциональность CLI за счет использования существующих инструментов и утилит.

### Применение CLI на Node.js
* Создание инструментов для сборки, тестирования, развертывания и управления Node.js-проектами.
* Автоматизация рутинных операций, связанных с разработкой и управлением серверами.
* Создание инструментов для управления файлами и каталогами (например, переименование файлов, создание резервных копий).
* Создание CLI для управления серверами, базами данных и другими Node.js приложениями.

 ## 2. Техническое руководство
### Предварительные требования
1. Базовые знания программирования на JavaScript и Node.js;
2. скаченная последняя версия Node.js (лучше всего установить с [официального сайта](https://nodejs.org/en/download));
3. среда разработки Visual Studio 2022 (или любая другая удобная для вас среда, поддерживающая разработку на Node.js. Далее в техническом руководстве будет описано создание в среде Visual Studio 2022);
4. встроеные компоненты для работы с Node.js.

### Модификации
При выполнении проектной практики я следовала [данной инструкции](https://citw.dev/tutorial/create-your-own-cli-tool?p=1). Код в ней написан на устаревшем синтаксисе модулей - CommonJS, поэтому код мной был переписан под современные стандарты Javascript, а именно под модули ES6 (ES Modules). Это сделало код более современным и производительным, улучшило его читаемость и соответствие современным практикам JavaScript, а также повысило совместимость с будущими версиями Node.js.

### Создание технологии

#### 1. Создание проекта
Перед началом работы необходимо создать проект в среде разработки. Для того чтобы создать проект в Visual Studio 2022 нужно открыть приложение и нажать на ```Создание проекта``` в правой части экрана. Затем, нужно выбрать нужный шаблон, для данной технологии необходимо выбрать шаблон ```Node.js Console Application``` и нажать ```Далее``` в нижней части экрана. После этого откроется новое окно, где вам нужно назвать свой проект и выбрать расположение файла. Далее проект будет называться ```tool-tutorial```. После указания всех необходимых настроек нужно нажать ```Создать``` и у вас автоматически откроется окто с вашим проектом.

#### 2. Открытие PowerShell для дальнейшей разработки проекта
Далее для разработки будет использоваться ```PowerShell```. Для того чтобы в Visual Studio 2022 зайти в ```PowerShell``` нужно нажать правой кнопкой мыши в ```Обозревателе решений``` на ```Решение "tool-tutorial"``` и в открывшемся окне нужно выбрать ```Открыть в терминале```. Тем самым у вас откроется ```PowerShell```, где уже мы будем создавать нужные файлы.
![image](https://github.com/user-attachments/assets/ad4c47ba-168e-46a8-8609-0ff2c77b885c)

#### 3. Создание папок и файлов
Для начала создадим главную папку проекта, где будут храниться все остальные файлы нашей командной строки. Чтобы создать необходимую папку, в ```PowerShell``` нужно ввести команду ```mkdir tool-tutorial```, тем самым в каталоге проекта создасться пустая папка ```tool-tutorial```. Затем нам нужно перейти в директорию папки ```tool-tutorial```, для этого в ```PowerShell``` мы вводим команду ```cd tool-tutorial```. Создаем папки ```tool``` и ```testProject``` анологичным образом.

После этого, нам нужно создать в обоих директориях пустые package.json файлы, чтобы там хранилась вся необходимая информация для управления проектом. Для этого мы используем команду ```npm init -y``` в директрориях tool и testProject.

Затем, создаем папки ```bin``` и ```src```в директории ```tool```. В папке ```bin``` с помощью команды ```New-Item -ItemType File -Path "bin/index.js" -Force``` создаем файл ```index.js```. В папке ```src``` нужно создать еще две папки:  ```comands``` и ```config```, а также файл ```logger.js```. В директории ```comands``` создаем файл ```start.js```, а в ```config``` - ```config-mgr.js``` и ```schema.json```. 

В директории ```testProject``` создаем файл ```tool.config.js```.

#### 4. Подключение библиотек и связь директорий
Теперь, когда все нужные файлы созданы, нам осталось подключить необходимые библиотеки и установить пакет ```tool``` в каталог ```testProject```.

В директории ```tool``` мы будем использовать такие библиотеки как: ```chalk```(для того, чтобы раскрасить надписи и тем самым сделать более понятный интерфейс), ```arv```( чтобы иметь возможность запускать инструмент с различными аргументами), ```arj``` (для проверки нашей конфигурации в соответствии со схемой Json), ```cоsmiconfig``` (для обработки конфигурации), отладочная библиотека ```debug```.

Чтобы добавить библиотеку ```chalk``` в директорию ```tool```, нужно ввесть команду ```npm i chalk```. Этим же способом добавляем все остальный библиотеки в эту же директорию.

После этого нам нужно установить пакет ```tool``` в каталог ```testProject```. Для этого мы будем использовать ```npm link``` для имитации установки. В директории  ```tool``` введите команду ```npm link```, а в директории  ```testProject``` - ```npm link tool```.

#### 5. tool
Теперь мы можем приступать к работе с кодом нашей командной строки. Начнем с создания самого CLI, он будет описан в папке tool.

Начнем с файла logger.js. Напишем код, который создаст модуль, который предоставляет функцию createlogger для создания логгеров (для отслеживания событий, ошибок, предупреждений):
```
import chalk from 'chalk';
import debug from 'debug';

export const createLogger = (name) => { 
    return {
        log: (...args) => console.log(chalk.gray(...args)),
        warning: (...args) => console.log(chalk.yellow(...args)),
        highlight: (...args) => console.log(chalk.bgCyanBright(...args)),
        debug: debug(name)
    };
};
```

Перейдем к папке ```commands```, а точнее к файлу ```start.js```, в котором мы опишем функцию start, которая отвечает за запуск и инициализацию самой командной строки:
```
import { createLogger } from '../logger.js'; 

const logger = createLogger('AppStarter');

const start = (config) => {
    logger.debug('Received configuration', config);
};

export default start;
```

Теперь перейдем к файлу ```config-mgr.js```, в нем будет написана функция getConfig, которая отвечает за загрузку и проверку конфигурации нашей командной сроки:
```
import path from 'path';
import { fileURLToPath } from 'url';
import { cosmiconfigSync } from 'cosmiconfig';
import { readFile } from 'fs/promises';
import betterAjvErrors from 'better-ajv-errors';
import Ajv from 'ajv';
import { createLogger } from '../logger.js'; 

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);


const logger = createLogger('ConfigManager');

const ajv = new Ajv();
const configLoader = cosmiconfigSync('tool');

async function loadSchema() {
    const data = await readFile(new URL('./schema.json', import.meta.url), 'utf8');
    return JSON.parse(data);
}

export default async function getConfig() {
    const schema = await loadSchema();
    const result = configLoader.search(process.cwd());

    if (!result) {
        logger.warning('Could not find configuration, using default');
        return { port: 1234 };
    } else {
        const isValid = ajv.validate(schema, result.config);
        if (!isValid) {
            logger.warning('Invalid configuration was supplied');
            console.log();
            console.log(betterAjvErrors(schema, result.config, ajv.errors));
            process.exit(1);
        }
        logger.debug('Found configuration', result.config);
        return result.config;
    }
}
```

Напишем код в файле schema.json - это файл, содержащий JSON Schema, описывающую структуру и типы данных допустимой конфигурации для нашего CLI. В нашем случае мы определяем, что единственным допустимым типом свойства port является number.:
```
{
  "properties": {
    "port": {
      "type": "number"
    }
  }
}
```

А теперь перейдем к основному исполняемому файлу командной строки, а именно к ```index.js```. Данный файл будет отвечать за разбор аргументов командной строки, загрузку конфигурации и запуск соответствующей команды.
```
#!/usr/bin/env node
import { createLogger } from '../src/logger.js';

const logger = createLogger('AppStarter');

logger.highlight('  Starting the app  ');

import arg from 'arg';
import chalk from 'chalk';
import getConfig from '../src/config/config-mgr.js';
import start from '../src/commands/start.js';

const usage = () => { 
    console.log(`${chalk.whiteBright('tool [CMD]')}
  ${chalk.greenBright('--start')}\tStarts the app
  ${chalk.greenBright('--build')}\tBuilds the app`);
};

try {
    const args = arg({
        '--start': Boolean,
        '--build': Boolean,
    });

    logger.debug('Received args', args);

    if (args['--start']) {
        const config = getConfig();
        start(config);
    } else {
        usage(); 
    }

} catch (e) {
    logger.warning(e.message);
    console.log();
    usage();
} 
```

Мы закончили работу с самой командной строкой, но теперь нам надо немного поработать с тестовым проектом, в котором мы будем проверять работу нашей командной строки.

#### 6. testProject
Для примера работы конфигурации, создадим ее в файле ```tool.config.js``` в папке ```testProject```:
```
export default {
    port: 6666
};
```
Работа над кодом проекта закончена и мы можем приступать к проверке работоспособности CLI.

#### 7. Работа командной строки
Командная строка будет запускаться в ```PowerShell``` от директории ```testProject```. Для того, чтобы запустить нашу командную строку нужна команда ```tool --start```, она запускает функцию ```start```. После этого должен последовать ответ ```Starting the app```. Пример как это должно выглядеть можете посмотреть на данном скрине:
![Снимок экрана (995)](https://github.com/user-attachments/assets/ab01d00b-9d21-4dc6-9b72-e6195054f26a)

Если мы введем просто команду tool, без уточнения конкретной команды, то в ответе должен появиться список доступных команд и их описание: 
```
tool [CMD]
  --start       Starts the app
  --build       Builds the app
```
Пример как это должно выглядеть в ```PowerShell```:
![image](https://github.com/user-attachments/assets/3288cc7a-0b1d-4682-9583-043356f7d311)

Так же можно проверить ошибки конфигурации, например задокументировав код в файле ```tool.config.js```. При введении команды ```tool --start``` должно вывести сообщение ```Could not find configuration, using default```
Пример как это должно выглядеть:
![8](https://github.com/user-attachments/assets/ccb314f6-3527-4d63-9837-600c734e700b)






 
